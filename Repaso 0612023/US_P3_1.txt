--Modificar, insertar y eliminar información la tabla del usuario US_P3_1: 
-- COMUNA.
/*
GRANT UPDATE ON US_P3_1.COMUNA TO US_P3_2;
GRANT INSERT ON US_P3_1.COMUNA TO US_P3_2;
GRANT DELETE ON US_P3_1.COMUNA TO US_P3_2;
*/
--  Crear un ROL ROL_CONSULTA que permita modificar, insertar y eliminar 
-- información en la tabla del usuario US_ P3_1: PROPIEDAD_ARRENDADA y 
-- asignárselo al usuario US_ P3_3
/*
CREATE ROLE RL_CONSULTA;

GRANT UPDATE ON US_P3_1.PROPIEDAD_ARRENDADA TO RL_CONSULTA;
GRANT INSERT ON US_P3_1.PROPIEDAD_ARRENDADA TO RL_CONSULTA;
GRANT DELETE ON US_P3_1.PROPIEDAD_ARRENDADA TO RL_CONSULTA;

GRANT RL_CONSULTA TO US_P3_3;
ALTER USER US_P3_3 DEFAULT ROLE RL_CONSULTA;



CREATE SYNONYM syn_p FOR propiedad;
CREATE SYNONYM syn_co FOR comuna;
CREATE SYNONYM syn_tp FOR tipo_propiedad;

GRANT SELECT ON syn_p TO US_P3_2 ;
GRANT SELECT ON syn_co TO US_P3_2;
GRANT SELECT ON syn_tp TO US_P3_2;



GRANT SELECT ON propiedad TO US_P3_3;
GRANT SELECT ON comuna TO US_P3_3;
GRANT SELECT ON tipo_propiedad TO US_P3_3;



GRANT SELECT ANY TABLE TO US_P3_2 WITH ADMIN OPTION;

*/

CREATE INDEX IDX_EMPLEADO ON EMPLEADO(EXTRACT(MONTH FROM FECNAC_EMP));

CREATE INDEX IDX_PROPIEDAD ON PROPIEDAD(VALOR_ARRIENDO,ID_TIPO_PROPIEDAD);

/* ejercicios para ET*/


CREATE TABLE RESUMEN_PROPIETARIO
(
RUT_PROP NUMBER(10),
NOMBREC_PROP VARCHAR (60)
);



INSERT INTO resumen_propietario
SELECT NUMRUT_PROP,NOMBRE_PROP||' '||APPATERNO_PROP||' '||APMATERNO_PROP AS NOMBRE
FROM PROPIETARIO
WHERE ID_COMUNA=82
UNION
SELECT PRO.NUMRUT_PROP,NOMBRE_PROP||' '||APPATERNO_PROP||' '||APMATERNO_PROP AS NOMBRE
FROM PROPIEDAD PD
INNER JOIN PROPIETARIO PRO ON PD.NUMRUT_PROP=PRO.NUMRUT_PROP
WHERE SUPERFICIE>=100;


SELECT NUMRUT_PROP,NOMBRE_PROP||' '||APPATERNO_PROP||' '||APMATERNO_PROP AS NOMBRE
FROM PROPIETARIO
WHERE NUMRUT_PROP IN(SELECT PRO.NUMRUT_PROP
FROM PROPIEDAD PD
INNER JOIN PROPIETARIO PRO ON PD.NUMRUT_PROP=PRO.NUMRUT_PROP
WHERE SUPERFICIE>=100 OR PRO.ID_COMUNA=82);

COMMIT;
SELECT * FROM resumen_propietario;
SELECT RUT_PROP FROM resumen_propietario;

SELECT * FROM PROPIEDAD;


UPDATE PROPIEDAD 
SET VALOR_ARRIENDO=VALOR_ARRIENDO+1
WHERE NUMRUT_PROP IN(SELECT RUT_PROP FROM resumen_propietario);

COMMIT;
SELECT * FROM PROPIEDAD;
